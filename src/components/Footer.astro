---
import { getThemeConfig } from "@/utils";
import Divider from "./base/Divider.astro";

// 获取主题配置
let { footer, author, social } = getThemeConfig().site;
let { icp, copyright } = footer;
// development环境下不获取commitHash 请先执行pnpm run version
let { commitHash, version } = getThemeConfig().theme!;
---

<footer>
  <div class="container">
    <div class="socials">
      {
        social.map((item) => {
          return (
            <a href={item.url}>
              <i class={item.icon} />
              <span>{item.name}</span>
            </a>
          );
        })
      }
    </div>
    <Divider />
    <div class="copyright">
      <span class="copy">
        <i class="ri-copyright-line"></i>
        <span class="time">{copyright.start}</span>
        <a class="bold" href="/">{author}</a>
        . All Rights Reserved.
      </span>
      {
        icp && (
          <span class="icp">
            <a class="bold" href={icp.url} target="_blank">
              <img src={icp.icon} alt={icp.info} />
              {icp.info}
            </a>
          </span>
        )
      }
      <span class="ver">
        Powered by <a class="bold" href="https://astro.build/" target="_blank"
          >Astro</a
        > & <a
          href="https://github.com/GuaiJieYo/Yuki"
          target="_blank"
          class="bold"
          data-github>Yuki({version})</a
        >
        <span class="version" data-github>
          <i class="ri-github-line"></i>
          版本哈希:
          {
            commitHash ? (
              <a
                class="bold"
                title="前往仓库查看"
                target="_blank"
                href={`https://github.com/GuaiJieYo/Yuki/commit/${commitHash}`}
              >
                {commitHash.slice(0, 10)}
              </a>
            ) : (
              "哈希值获取失败"
            )
          }
        </span>
      </span>
    </div>
  </div>
</footer>
<script>
  // 计算版权时间
  let copyTimeSpan = document.querySelector(
    ".copyright > span > .time"
  ) as HTMLElement;
  let nowYear = new Date().getFullYear().toString();
  copyTimeSpan.innerText =
    copyTimeSpan.innerText == nowYear
      ? nowYear
      : `${copyTimeSpan.innerText} - ${nowYear}`;

  // 移入效果
  let yukiGithubLink = document.querySelector(
    ".copyright > span > a[data-github]"
  ) as HTMLElement;
  let versionElement = document.querySelector(".version") as HTMLElement;

  // 显示版本哈希
  const showVersion = () => {
    versionElement.classList.add("show");
  };

  // 隐藏版本哈希
  const hideVersion = () => {
    versionElement.classList.remove("show");
  };

  // 为GitHub链接添加事件监听
  yukiGithubLink.addEventListener("mouseenter", showVersion);
  yukiGithubLink.addEventListener("mouseleave", () => {
    // 检查鼠标是否移动到了版本元素上
    setTimeout(() => {
      if (!versionElement.matches(":hover")) {
        hideVersion();
      }
    }, 100);
  });

  // 为版本元素添加事件监听
  versionElement.addEventListener("mouseenter", showVersion);
  versionElement.addEventListener("mouseleave", hideVersion);
</script>

<style lang="scss">
  footer {
    width: 100%;
    color: var(--text-color);
    background-color: var(--bg-color);
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0 20px;
    margin-top: 20px;
    .container {
      width: 1200px;
      display: flex;
      flex-direction: column;

      .copyright {
        width: 100%;
        margin: 8px auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 1.1rem;

        span {
          &.icp {
            a {
              display: flex;
              align-items: center;
              img {
                flex-shrink: 0;
                width: 25px;
                height: 25px;
                object-fit: cover;
                margin-right: 10px;
              }
            }
          }

          &.ver {
            position: relative;
          }

          .version {
            position: absolute;
            top: -50px;
            right: 0;
            padding: 8px 12px;
            border-radius: 10px;
            background: var(--bg-color);
            box-shadow: rgba(0, 0, 0, 0.24) 0px 3px 8px;
            white-space: nowrap;
            transition: all 0.3s ease-in-out;

            // 隐藏
            opacity: 0;
            visibility: hidden;
            transform: translateY(-20px) scale(0);

            &.show {
              opacity: 1;
              visibility: visible;
              transform: translateY(0) scale(1);
            }
          }
        }
      }
    }
  }
</style>
